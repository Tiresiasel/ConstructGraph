# 调节变量功能说明

## 功能概述

本更新为知识图谱可视化添加了调节变量的特殊交互功能，当点击调节变量时，会高亮整个三角形（包括被调节的两个构型以及它们之间的连接），并在悬浮和详情面板中显示调节关系的详细信息。

## 主要功能

### 1. 三角形高亮
- **触发方式**: 点击调节变量节点（如 "single-homing"）
- **效果**: 高亮整个三角形，包括：
  - 调节变量节点
  - 被调节的两个构型节点
  - 主关系连接线
  - 调节变量到两个构型的虚线连接

### 2. 悬浮提示增强
- **调节变量节点悬浮**: 显示调节变量信息，包括调节的关系、作用、状态等
- **调节变量连线悬浮**: 显示调节变量连线的详细信息

### 3. 右侧详情面板增强
- **调节变量信息**: 在构型详情中添加专门的调节变量信息区域
- **完整关系描述**: 显示调节变量如何影响两个构型之间的关系

## 技术实现

### 数据结构
```javascript
moderatorInfo: {
    moderator: "single-homing",
    source: "resource heterogeneity", 
    target: "sustained competitive advantage",
    relationship: { /* 完整的关系数据 */ }
}
```

### 核心逻辑
1. **调节变量识别**: 通过 `moderatorInfo` 属性识别调节变量边
2. **三角形构建**: 自动构建包含调节变量、源构型、目标构型的三角形
3. **高亮逻辑**: 使用 `fadeAllExcept` 函数高亮整个三角形
4. **信息显示**: 在工具提示和详情面板中显示调节变量相关信息

### CSS样式
- `.moderator-node`: 调节变量节点的特殊样式
- `.moderator-edge`: 调节变量连线的特殊样式  
- `.moderator-triangle`: 调节变量三角形的特殊样式

## 使用示例

### 示例1: Resource Heterogeneity → Sustained Competitive Advantage
- **调节变量**: single-homing
- **关系**: 在单归属市场结构中，资源异质性对持续竞争优势的影响
- **交互**: 点击 "single-homing" 节点高亮整个三角形

### 示例2: 其他调节关系
- 任何被标记为调节变量的构型都会自动获得这些功能
- 系统会自动识别调节关系并应用相应的交互逻辑

## 文件修改

### 主要修改文件
- `scripts/visualize_graph.py`: 核心功能实现

### 新增功能
1. 调节变量三角形高亮
2. 调节变量悬浮提示
3. 调节变量详情面板
4. 调节变量CSS样式

## 测试方法

1. 运行 `python3 scripts/visualize_graph.py` 生成可视化
2. 在浏览器中打开 `constructs_network.html`
3. 点击调节变量节点（如 "single-homing"）测试三角形高亮
4. 悬浮在调节变量上查看提示信息
5. 查看右侧详情面板的调节变量信息

## 注意事项

- 调节变量功能依赖于数据中的 `moderators` 字段
- 只有被正确标记为调节变量的构型才会触发这些功能
- 三角形高亮会暂时隐藏其他节点和边，点击背景可恢复
- 所有调节变量信息都基于数据库中的实际关系数据
